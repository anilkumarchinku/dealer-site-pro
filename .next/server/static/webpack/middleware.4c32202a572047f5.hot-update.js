"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("middleware",{

/***/ "(middleware)/./middleware.ts":
/*!***********************!*\
  !*** ./middleware.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   middleware: () => (/* binding */ middleware)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(middleware)/./node_modules/next/dist/esm/api/server.js\");\n/* harmony import */ var _supabase_ssr__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @supabase/ssr */ \"(middleware)/./node_modules/@supabase/ssr/dist/module/index.js\");\n/* harmony import */ var _lib_utils_slug__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./lib/utils/slug */ \"(middleware)/./lib/utils/slug.ts\");\n\n\n\nconst PROTECTED_PREFIXES = [\n    '/dashboard',\n    '/onboarding'\n];\nconst AUTH_PAGES = [\n    '/auth/login',\n    '/auth/register'\n];\n// Base domain from env (e.g. \"your-project.vercel.app\" or \"dealersitepro.com\")\nconst BASE_DOMAIN = \"localhost:3000\" ?? 0;\nconst USE_SUBDOMAIN = \"false\" === 'true';\n// In-memory cache for domain lookups\nconst domainCache = new Map();\nconst CACHE_TTL = 60000 // 60 seconds\n;\nasync function middleware(request) {\n    const hostname = request.headers.get('host') || '';\n    const pathname = request.nextUrl.pathname;\n    // ── Skip static files, API routes, Next.js internals ─────\n    if (pathname.startsWith('/_next') || pathname.startsWith('/api') || pathname.startsWith('/static') || pathname.includes('.') || pathname.startsWith('/favicon')) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n    }\n    // ── Main domain detection ─────────────────────────────────\n    // Always treat the configured BASE_DOMAIN, localhost, and all\n    // *.vercel.app URLs as the \"main\" domain — never as dealer subdomains.\n    const isMainDomain = hostname === BASE_DOMAIN || hostname === `www.${BASE_DOMAIN}` || hostname.startsWith('localhost') || hostname.endsWith('.vercel.app') // Vercel preview/production deployments\n    ;\n    // ── Subdomain / custom domain routing ────────────────────\n    // Only active when USE_SUBDOMAIN=true AND we're NOT on the main domain.\n    // Requires wildcard DNS pointing to this app (e.g. *.dealersitepro.com).\n    if (!isMainDomain && USE_SUBDOMAIN) {\n        const slug = (0,_lib_utils_slug__WEBPACK_IMPORTED_MODULE_2__.extractSlugFromHostname)(hostname, BASE_DOMAIN);\n        if (!slug) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL(`https://${BASE_DOMAIN}/not-found`, request.url));\n        }\n        const cached = domainCache.get(hostname);\n        if (cached && cached.expires > Date.now()) {\n            const url = request.nextUrl.clone();\n            url.pathname = `/sites/${cached.slug}${pathname}`;\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.rewrite(url);\n        }\n        domainCache.set(hostname, {\n            slug,\n            expires: Date.now() + CACHE_TTL\n        });\n        const url = request.nextUrl.clone();\n        url.pathname = `/sites/${slug}${pathname}`;\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.rewrite(url);\n    }\n    // ── Custom domain routing (non-Vercel, non-BASE_DOMAIN hosts) ──────────\n    // A dealer may point their own domain (abcmotors.com) here.\n    // In that case we look up the slug from the dealer_domains table via\n    // the /api/domains/resolve route (handled separately).\n    if (!isMainDomain && !USE_SUBDOMAIN) {\n        // Unknown host — treat as a custom domain dealer site\n        const slug = (0,_lib_utils_slug__WEBPACK_IMPORTED_MODULE_2__.extractSlugFromHostname)(hostname, BASE_DOMAIN);\n        if (slug) {\n            const url = request.nextUrl.clone();\n            url.pathname = `/sites/${slug}${pathname}`;\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.rewrite(url);\n        }\n        // Custom domain (abcmotors.com) — rewrite to /sites/[custom-domain]\n        // The page.tsx will resolve it via dealer_domains lookup\n        const url = request.nextUrl.clone();\n        url.pathname = `/sites/${hostname}${pathname}`;\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.rewrite(url);\n    }\n    // ── Auth guard (only on main domain) ─────────────────────\n    const supabaseUrl = \"https://llsvbyeumrfngjvbedbz.supabase.co\";\n    const supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxsc3ZieWV1bXJmbmdqdmJlZGJ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzMDgzMTcsImV4cCI6MjA4Njg4NDMxN30.kn3MapP6pgc-bBIStItk2wPwEoSHMI2kOH5Cz4H_UTg\";\n    // If Supabase isn't configured, skip auth checks entirely\n    if (!supabaseUrl || !supabaseAnonKey || supabaseUrl.includes('placeholder') || supabaseUrl === 'https://your-project.supabase.co') {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n    }\n    const response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next({\n        request: {\n            headers: request.headers\n        }\n    });\n    const supabase = (0,_supabase_ssr__WEBPACK_IMPORTED_MODULE_1__.createServerClient)(supabaseUrl, supabaseAnonKey, {\n        cookies: {\n            getAll () {\n                return request.cookies.getAll();\n            },\n            setAll (cookiesToSet) {\n                cookiesToSet.forEach(({ name, value, options })=>{\n                    request.cookies.set(name, value);\n                    response.cookies.set(name, value, options);\n                });\n            }\n        }\n    });\n    const { data: { session } } = await supabase.auth.getSession();\n    const isLoggedIn = !!session;\n    const isProtected = PROTECTED_PREFIXES.some((p)=>pathname.startsWith(p));\n    const isAuthPage = AUTH_PAGES.some((p)=>pathname.startsWith(p));\n    // Redirect to login if accessing protected route without session\n    if (isProtected && !isLoggedIn) {\n        const loginUrl = new URL('/auth/login', request.url);\n        loginUrl.searchParams.set('redirect', pathname);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(loginUrl);\n    }\n    // Redirect to dashboard if already logged in and visiting auth pages\n    if (isAuthPage && isLoggedIn) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL('/dashboard', request.url));\n    }\n    return response;\n}\nconst config = {\n    matcher: [\n        '/((?!_next/static|_next/image|favicon.ico|api).*)'\n    ]\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFpRTtJQUNqRSxJQUFJRixlQUFlLENBQUNELFlBQVk7UUFDNUIsTUFBTUssV0FBVyxJQUFJaEMsSUFBSSxlQUFlYixRQUFRYyxHQUFHO1FBQ25EK0IsU0FBU0MsWUFBWSxDQUFDekIsR0FBRyxDQUFDLFlBQVlqQjtRQUN0QyxPQUFPbkIscURBQVlBLENBQUMyQixRQUFRLENBQUNpQztJQUNqQztJQUVBLHFFQUFxRTtJQUNyRSxJQUFJRCxjQUFjSixZQUFZO1FBQzFCLE9BQU92RCxxREFBWUEsQ0FBQzJCLFFBQVEsQ0FBQyxJQUFJQyxJQUFJLGNBQWNiLFFBQVFjLEdBQUc7SUFDbEU7SUFFQSxPQUFPWTtBQUNYO0FBRU8sTUFBTXFCLFNBQVM7SUFDbEJDLFNBQVM7UUFDTDtLQUNIO0FBQ0wsRUFBQyIsInNvdXJjZXMiOlsiL1VzZXJzL2FuaWxrdW1hcmtvbHVrdWxhcGFsbGkvcHJvamVjdHMvY3llcHJvL2RlYWxlcnNpdGUgcHJvL2RlYWxlci1zaXRlLXByby9taWRkbGV3YXJlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcidcbmltcG9ydCB7IGNyZWF0ZVNlcnZlckNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zc3InXG5pbXBvcnQgeyBleHRyYWN0U2x1Z0Zyb21Ib3N0bmFtZSB9IGZyb20gJy4vbGliL3V0aWxzL3NsdWcnXG5cbmNvbnN0IFBST1RFQ1RFRF9QUkVGSVhFUyA9IFsnL2Rhc2hib2FyZCcsICcvb25ib2FyZGluZyddXG5jb25zdCBBVVRIX1BBR0VTICAgICAgID0gWycvYXV0aC9sb2dpbicsICcvYXV0aC9yZWdpc3RlciddXG5cbi8vIEJhc2UgZG9tYWluIGZyb20gZW52IChlLmcuIFwieW91ci1wcm9qZWN0LnZlcmNlbC5hcHBcIiBvciBcImRlYWxlcnNpdGVwcm8uY29tXCIpXG5jb25zdCBCQVNFX0RPTUFJTiA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0JBU0VfRE9NQUlOID8/ICdkZWFsZXJzaXRlcHJvLmNvbSdcbmNvbnN0IFVTRV9TVUJET01BSU4gPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19VU0VfU1VCRE9NQUlOID09PSAndHJ1ZSdcblxuLy8gSW4tbWVtb3J5IGNhY2hlIGZvciBkb21haW4gbG9va3Vwc1xuY29uc3QgZG9tYWluQ2FjaGUgPSBuZXcgTWFwPHN0cmluZywgeyBzbHVnOiBzdHJpbmc7IGV4cGlyZXM6IG51bWJlciB9PigpXG5jb25zdCBDQUNIRV9UVEwgPSA2MDAwMCAvLyA2MCBzZWNvbmRzXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBtaWRkbGV3YXJlKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gICAgY29uc3QgaG9zdG5hbWUgPSByZXF1ZXN0LmhlYWRlcnMuZ2V0KCdob3N0JykgfHwgJydcbiAgICBjb25zdCBwYXRobmFtZSA9IHJlcXVlc3QubmV4dFVybC5wYXRobmFtZVxuXG4gICAgLy8g4pSA4pSAIFNraXAgc3RhdGljIGZpbGVzLCBBUEkgcm91dGVzLCBOZXh0LmpzIGludGVybmFscyDilIDilIDilIDilIDilIBcbiAgICBpZiAoXG4gICAgICAgIHBhdGhuYW1lLnN0YXJ0c1dpdGgoJy9fbmV4dCcpIHx8XG4gICAgICAgIHBhdGhuYW1lLnN0YXJ0c1dpdGgoJy9hcGknKSB8fFxuICAgICAgICBwYXRobmFtZS5zdGFydHNXaXRoKCcvc3RhdGljJykgfHxcbiAgICAgICAgcGF0aG5hbWUuaW5jbHVkZXMoJy4nKSB8fFxuICAgICAgICBwYXRobmFtZS5zdGFydHNXaXRoKCcvZmF2aWNvbicpXG4gICAgKSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UubmV4dCgpXG4gICAgfVxuXG4gICAgLy8g4pSA4pSAIE1haW4gZG9tYWluIGRldGVjdGlvbiDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcbiAgICAvLyBBbHdheXMgdHJlYXQgdGhlIGNvbmZpZ3VyZWQgQkFTRV9ET01BSU4sIGxvY2FsaG9zdCwgYW5kIGFsbFxuICAgIC8vICoudmVyY2VsLmFwcCBVUkxzIGFzIHRoZSBcIm1haW5cIiBkb21haW4g4oCUIG5ldmVyIGFzIGRlYWxlciBzdWJkb21haW5zLlxuICAgIGNvbnN0IGlzTWFpbkRvbWFpbiA9XG4gICAgICAgIGhvc3RuYW1lID09PSBCQVNFX0RPTUFJTiB8fFxuICAgICAgICBob3N0bmFtZSA9PT0gYHd3dy4ke0JBU0VfRE9NQUlOfWAgfHxcbiAgICAgICAgaG9zdG5hbWUuc3RhcnRzV2l0aCgnbG9jYWxob3N0JykgfHxcbiAgICAgICAgaG9zdG5hbWUuZW5kc1dpdGgoJy52ZXJjZWwuYXBwJykgICAvLyBWZXJjZWwgcHJldmlldy9wcm9kdWN0aW9uIGRlcGxveW1lbnRzXG5cbiAgICAvLyDilIDilIAgU3ViZG9tYWluIC8gY3VzdG9tIGRvbWFpbiByb3V0aW5nIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFxuICAgIC8vIE9ubHkgYWN0aXZlIHdoZW4gVVNFX1NVQkRPTUFJTj10cnVlIEFORCB3ZSdyZSBOT1Qgb24gdGhlIG1haW4gZG9tYWluLlxuICAgIC8vIFJlcXVpcmVzIHdpbGRjYXJkIEROUyBwb2ludGluZyB0byB0aGlzIGFwcCAoZS5nLiAqLmRlYWxlcnNpdGVwcm8uY29tKS5cbiAgICBpZiAoIWlzTWFpbkRvbWFpbiAmJiBVU0VfU1VCRE9NQUlOKSB7XG4gICAgICAgIGNvbnN0IHNsdWcgPSBleHRyYWN0U2x1Z0Zyb21Ib3N0bmFtZShob3N0bmFtZSwgQkFTRV9ET01BSU4pXG4gICAgICAgIGlmICghc2x1Zykge1xuICAgICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5yZWRpcmVjdChuZXcgVVJMKGBodHRwczovLyR7QkFTRV9ET01BSU59L25vdC1mb3VuZGAsIHJlcXVlc3QudXJsKSlcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGNhY2hlZCA9IGRvbWFpbkNhY2hlLmdldChob3N0bmFtZSlcbiAgICAgICAgaWYgKGNhY2hlZCAmJiBjYWNoZWQuZXhwaXJlcyA+IERhdGUubm93KCkpIHtcbiAgICAgICAgICAgIGNvbnN0IHVybCA9IHJlcXVlc3QubmV4dFVybC5jbG9uZSgpXG4gICAgICAgICAgICB1cmwucGF0aG5hbWUgPSBgL3NpdGVzLyR7Y2FjaGVkLnNsdWd9JHtwYXRobmFtZX1gXG4gICAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLnJld3JpdGUodXJsKVxuICAgICAgICB9XG5cbiAgICAgICAgZG9tYWluQ2FjaGUuc2V0KGhvc3RuYW1lLCB7IHNsdWcsIGV4cGlyZXM6IERhdGUubm93KCkgKyBDQUNIRV9UVEwgfSlcbiAgICAgICAgY29uc3QgdXJsID0gcmVxdWVzdC5uZXh0VXJsLmNsb25lKClcbiAgICAgICAgdXJsLnBhdGhuYW1lID0gYC9zaXRlcy8ke3NsdWd9JHtwYXRobmFtZX1gXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmV3cml0ZSh1cmwpXG4gICAgfVxuXG4gICAgLy8g4pSA4pSAIEN1c3RvbSBkb21haW4gcm91dGluZyAobm9uLVZlcmNlbCwgbm9uLUJBU0VfRE9NQUlOIGhvc3RzKSDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcbiAgICAvLyBBIGRlYWxlciBtYXkgcG9pbnQgdGhlaXIgb3duIGRvbWFpbiAoYWJjbW90b3JzLmNvbSkgaGVyZS5cbiAgICAvLyBJbiB0aGF0IGNhc2Ugd2UgbG9vayB1cCB0aGUgc2x1ZyBmcm9tIHRoZSBkZWFsZXJfZG9tYWlucyB0YWJsZSB2aWFcbiAgICAvLyB0aGUgL2FwaS9kb21haW5zL3Jlc29sdmUgcm91dGUgKGhhbmRsZWQgc2VwYXJhdGVseSkuXG4gICAgaWYgKCFpc01haW5Eb21haW4gJiYgIVVTRV9TVUJET01BSU4pIHtcbiAgICAgICAgLy8gVW5rbm93biBob3N0IOKAlCB0cmVhdCBhcyBhIGN1c3RvbSBkb21haW4gZGVhbGVyIHNpdGVcbiAgICAgICAgY29uc3Qgc2x1ZyA9IGV4dHJhY3RTbHVnRnJvbUhvc3RuYW1lKGhvc3RuYW1lLCBCQVNFX0RPTUFJTilcbiAgICAgICAgaWYgKHNsdWcpIHtcbiAgICAgICAgICAgIGNvbnN0IHVybCA9IHJlcXVlc3QubmV4dFVybC5jbG9uZSgpXG4gICAgICAgICAgICB1cmwucGF0aG5hbWUgPSBgL3NpdGVzLyR7c2x1Z30ke3BhdGhuYW1lfWBcbiAgICAgICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmV3cml0ZSh1cmwpXG4gICAgICAgIH1cbiAgICAgICAgLy8gQ3VzdG9tIGRvbWFpbiAoYWJjbW90b3JzLmNvbSkg4oCUIHJld3JpdGUgdG8gL3NpdGVzL1tjdXN0b20tZG9tYWluXVxuICAgICAgICAvLyBUaGUgcGFnZS50c3ggd2lsbCByZXNvbHZlIGl0IHZpYSBkZWFsZXJfZG9tYWlucyBsb29rdXBcbiAgICAgICAgY29uc3QgdXJsID0gcmVxdWVzdC5uZXh0VXJsLmNsb25lKClcbiAgICAgICAgdXJsLnBhdGhuYW1lID0gYC9zaXRlcy8ke2hvc3RuYW1lfSR7cGF0aG5hbWV9YFxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLnJld3JpdGUodXJsKVxuICAgIH1cblxuICAgIC8vIOKUgOKUgCBBdXRoIGd1YXJkIChvbmx5IG9uIG1haW4gZG9tYWluKSDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcbiAgICBjb25zdCBzdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTFxuICAgIGNvbnN0IHN1cGFiYXNlQW5vbktleSA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZXG5cbiAgICAvLyBJZiBTdXBhYmFzZSBpc24ndCBjb25maWd1cmVkLCBza2lwIGF1dGggY2hlY2tzIGVudGlyZWx5XG4gICAgaWYgKCFzdXBhYmFzZVVybCB8fCAhc3VwYWJhc2VBbm9uS2V5IHx8XG4gICAgICAgIHN1cGFiYXNlVXJsLmluY2x1ZGVzKCdwbGFjZWhvbGRlcicpIHx8XG4gICAgICAgIHN1cGFiYXNlVXJsID09PSAnaHR0cHM6Ly95b3VyLXByb2plY3Quc3VwYWJhc2UuY28nKSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UubmV4dCgpXG4gICAgfVxuXG4gICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UubmV4dCh7XG4gICAgICAgIHJlcXVlc3Q6IHsgaGVhZGVyczogcmVxdWVzdC5oZWFkZXJzIH0sXG4gICAgfSlcblxuICAgIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlU2VydmVyQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZUFub25LZXksIHtcbiAgICAgICAgY29va2llczoge1xuICAgICAgICAgICAgZ2V0QWxsKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXF1ZXN0LmNvb2tpZXMuZ2V0QWxsKClcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRBbGwoY29va2llc1RvU2V0KSB7XG4gICAgICAgICAgICAgICAgY29va2llc1RvU2V0LmZvckVhY2goKHsgbmFtZSwgdmFsdWUsIG9wdGlvbnMgfSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LmNvb2tpZXMuc2V0KG5hbWUsIHZhbHVlKVxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5jb29raWVzLnNldChuYW1lLCB2YWx1ZSwgb3B0aW9ucylcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICB9KVxuXG4gICAgY29uc3QgeyBkYXRhOiB7IHNlc3Npb24gfSB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRTZXNzaW9uKClcbiAgICBjb25zdCBpc0xvZ2dlZEluID0gISFzZXNzaW9uXG5cbiAgICBjb25zdCBpc1Byb3RlY3RlZCA9IFBST1RFQ1RFRF9QUkVGSVhFUy5zb21lKHAgPT4gcGF0aG5hbWUuc3RhcnRzV2l0aChwKSlcbiAgICBjb25zdCBpc0F1dGhQYWdlICA9IEFVVEhfUEFHRVMuc29tZShwID0+IHBhdGhuYW1lLnN0YXJ0c1dpdGgocCkpXG5cbiAgICAvLyBSZWRpcmVjdCB0byBsb2dpbiBpZiBhY2Nlc3NpbmcgcHJvdGVjdGVkIHJvdXRlIHdpdGhvdXQgc2Vzc2lvblxuICAgIGlmIChpc1Byb3RlY3RlZCAmJiAhaXNMb2dnZWRJbikge1xuICAgICAgICBjb25zdCBsb2dpblVybCA9IG5ldyBVUkwoJy9hdXRoL2xvZ2luJywgcmVxdWVzdC51cmwpXG4gICAgICAgIGxvZ2luVXJsLnNlYXJjaFBhcmFtcy5zZXQoJ3JlZGlyZWN0JywgcGF0aG5hbWUpXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QobG9naW5VcmwpXG4gICAgfVxuXG4gICAgLy8gUmVkaXJlY3QgdG8gZGFzaGJvYXJkIGlmIGFscmVhZHkgbG9nZ2VkIGluIGFuZCB2aXNpdGluZyBhdXRoIHBhZ2VzXG4gICAgaWYgKGlzQXV0aFBhZ2UgJiYgaXNMb2dnZWRJbikge1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KG5ldyBVUkwoJy9kYXNoYm9hcmQnLCByZXF1ZXN0LnVybCkpXG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3BvbnNlXG59XG5cbmV4cG9ydCBjb25zdCBjb25maWcgPSB7XG4gICAgbWF0Y2hlcjogW1xuICAgICAgICAnLygoPyFfbmV4dC9zdGF0aWN8X25leHQvaW1hZ2V8ZmF2aWNvbi5pY298YXBpKS4qKScsXG4gICAgXSxcbn1cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJjcmVhdGVTZXJ2ZXJDbGllbnQiLCJleHRyYWN0U2x1Z0Zyb21Ib3N0bmFtZSIsIlBST1RFQ1RFRF9QUkVGSVhFUyIsIkFVVEhfUEFHRVMiLCJCQVNFX0RPTUFJTiIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19CQVNFX0RPTUFJTiIsIlVTRV9TVUJET01BSU4iLCJORVhUX1BVQkxJQ19VU0VfU1VCRE9NQUlOIiwiZG9tYWluQ2FjaGUiLCJNYXAiLCJDQUNIRV9UVEwiLCJtaWRkbGV3YXJlIiwicmVxdWVzdCIsImhvc3RuYW1lIiwiaGVhZGVycyIsImdldCIsInBhdGhuYW1lIiwibmV4dFVybCIsInN0YXJ0c1dpdGgiLCJpbmNsdWRlcyIsIm5leHQiLCJpc01haW5Eb21haW4iLCJlbmRzV2l0aCIsInNsdWciLCJyZWRpcmVjdCIsIlVSTCIsInVybCIsImNhY2hlZCIsImV4cGlyZXMiLCJEYXRlIiwibm93IiwiY2xvbmUiLCJyZXdyaXRlIiwic2V0Iiwic3VwYWJhc2VVcmwiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJzdXBhYmFzZUFub25LZXkiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsInJlc3BvbnNlIiwic3VwYWJhc2UiLCJjb29raWVzIiwiZ2V0QWxsIiwic2V0QWxsIiwiY29va2llc1RvU2V0IiwiZm9yRWFjaCIsIm5hbWUiLCJ2YWx1ZSIsIm9wdGlvbnMiLCJkYXRhIiwic2Vzc2lvbiIsImF1dGgiLCJnZXRTZXNzaW9uIiwiaXNMb2dnZWRJbiIsImlzUHJvdGVjdGVkIiwic29tZSIsInAiLCJpc0F1dGhQYWdlIiwibG9naW5VcmwiLCJzZWFyY2hQYXJhbXMiLCJjb25maWciLCJtYXRjaGVyIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(middleware)/./middleware.ts\n");

/***/ })

});